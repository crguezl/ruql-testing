<html>
  <head>
    <title>Example quiz</title>
    <style>
      div.quiz, p.comment, div.explanation {display:inline;}
      strong.correct {color:#14B63F;}
      strong.incorrect {color:rgb(255,0,0);}
      strong.mark {color:rgb(255,128,0);}
      input.correct {color:#14B63F; font-weight: bold;}
      input.incorrect {color:rgb(255,0,0); font-weight: bold;}
      div.btn-footer {text-align: center;}
      p.comment, div.explanation {font-style: italic;}
    </style>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="stylesheet" type="text/css" href="/Users/casiano/local/academica/centros/ETSII/grado/PL/2013_2014/EXAMENES/090414/estilo.css"/>
    <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.0.min.js">
    </script>
<!--[if lt IE 8]>    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js">
    </script>
<![endif]-->  </head>
  <body>
    <!-- Seed: 233818899665804723823319520404505541935 -->
    <form id="form">
      <ol class="questions">
        <li id="question-0" class="question fillin ">
          <div class="quiz text">
[2 points] The visionary founder of Apple is <input type=text id=qfi1-1 class=fillin></input><div id=qfi1-1r class=quiz></div></br></br>          </div>
          <p class="comment">
Question too easy<br></br>          </p>
        </li>
        <li id="question-1" class="question fillin ">
          <div class="quiz text">
[1 point] The <input type=text id=qfi2-1 class=fillin></input> brown fox jumped over the lazy <input type=text id=qfi2-2 class=fillin></input><div id=qfi2-2r class=quiz></div></br></br>          </div>
        </li>
        <li id="question-2" class="question fillin ">
          <div class="quiz text">
[1 point] The three stooges are <input type=text id=qfi3-1 class=fillin></input>, <input type=text id=qfi3-2 class=fillin></input>, and <input type=text id=qfi3-3 class=fillin></input><div id=qfi3-3r class=quiz></div></br></br>          </div>
        </li>
        <li id="question-3" class="question fillin ">
          <div class="quiz text">
[1 point] 
      Calculate the determinant of this matrix:
      $$\mathbf{A} = \begin{vmatrix} 
      1 & 3 \\ 
      2 & 4 
      \end{vmatrix}$$
      <br/>
      <input type=text id=qfi4-1 class=fillin></input>
    <div id=qfi4-1r class=quiz></div></br></br>          </div>
        </li>
        <li id="question-4" class="question fillin ">
          <div class="quiz text">
[1 point] 
      Solve: 
      $$\binom{n}{k} = \frac{n!}{k!(n-k)!}$$
      when n = 5 and k = 2:
      <input type=text id=qfi5-1 class=fillin></input>
    <div id=qfi5-1r class=quiz></div></br></br>          </div>
        </li>
        <li id="question-5" class="question fillin ">
          <div class="quiz text">
[1 point] 
      When x = 2, the solution of $\sqrt{3x+3}+(1+x)^2$ is:
      <input type=text id=qfi6-1 class=fillin></input>
    <div id=qfi6-1r class=quiz></div></br></br>          </div>
        </li>
        <li id="question-6" class="question multiplechoice ">
          <div class="quiz text">
[1 point] What is the largest US state?<br></br>          </div>
          <ol class="answers">
            <input type="radio" id="qmc7-1" name="qmc7" class="select">
Texas<br class=qmc7-1br>            </input>
            <div id="qmc7-1r" class="quiz">
            </div>
            <input type="radio" id="qmc7-2" name="qmc7" class="select">
Hawaii<br class=qmc7-2br>            </input>
            <div id="qmc7-2r" class="quiz">
            </div>
            <input type="radio" id="qmc7-3" name="qmc7" class="select">
Alaska<br class=qmc7-3br>            </input>
            <div id="qmc7-3r" class="quiz">
            </div>
            <br/>
          </ol>
        </li>
        <li id="question-7" class="question selectmultiple multiple">
          <div class="quiz text">
[1 point] Select ALL that apply: Which are American political parties?<br></br>          </div>
          <ol class="answers">
            <input type="checkbox" id="qsm8-1" class="check">
Democrats<br class=qsm8-1br>            </input>
            <div id="qsm8-1r" class="quiz">
            </div>
            <input type="checkbox" id="qsm8-2" class="check">
Republicans<br class=qsm8-2br>            </input>
            <div id="qsm8-2r" class="quiz">
            </div>
            <input type="checkbox" id="qsm8-3" class="check">
Greens<br class=qsm8-3br>            </input>
            <div id="qsm8-3r" class="quiz">
            </div>
            <input type="checkbox" id="qsm8-4" class="check">
Tories<br class=qsm8-4br>            </input>
            <div id="qsm8-4r" class="quiz">
            </div>
            <input type="checkbox" id="qsm8-5" class="check">
Social Democrats<br class=qsm8-5br>            </input>
            <div id="qsm8-5r" class="quiz">
            </div>
            <br/>
          </ol>
        </li>
        <li id="question-8" class="question truefalse ">
          <div class="quiz text">
[1 point] True or False: The earth is flat.<br></br>          </div>
          <ol class="answers">
            <input type="radio" id="qmc9-1" name="qmc9" class="select">
True<br class=qmc9-1br>            </input>
            <div id="qmc9-1r" class="quiz">
            </div>
            <input type="radio" id="qmc9-2" name="qmc9" class="select">
False<br class=qmc9-2br>            </input>
            <div id="qmc9-2r" class="quiz">
            </div>
            <br/>
          </ol>
        </li>
        <li id="question-9" class="question multiplechoice ">
          <div class="quiz text">
[1 point] What does the following code do:
    <pre>
    puts "Hello world!"
    </pre>
              </div>
          <ol class="answers">
            <input type="radio" id="qmc10-1" name="qmc10" class="select">
Throws an exception<br class=qmc10-1br>            </input>
            <div id="qmc10-1r" class="quiz">
            </div>
            <input type="radio" id="qmc10-2" name="qmc10" class="select">
Prints a friendly message<br class=qmc10-2br>            </input>
            <div id="qmc10-2r" class="quiz">
            </div>
            <br/>
          </ol>
        </li>
      </ol>
      <div class="btn-footer">
        <button type="button" id="submit" class="btn btn-primary">
Submit        </button>
        <button type="button" id="reset" class="btn btn-warning">
Reset        </button>
      </div>
    </form>
    <script type="text/javascript">
      data = {"question-0":{"question_text":"The visionary founder of Apple is ---","answers":{"qfi1-1":{"answer_text":"/^ste(ve|phen)\\s+jobs$/mi","correct":true,"explanation":null,"type":"Regexp"},"qfi1-2":{"answer_text":"/^steve\\s+wozniak/i","correct":false,"explanation":"Almost, but not quite.","type":"Regexp"}},"points":2,"order":false,"question_comment":"Question too easy"},"question-1":{"question_text":"The --- brown fox jumped over the lazy ---","answers":{"qfi2-1":{"answer_text":"/fox/","correct":true,"explanation":"This sentence contains all of the letters of the English Alphabet","type":"Regexp"},"qfi2-2":{"answer_text":"/dog/","correct":true,"explanation":"This sentence contains all of the letters of the English Alphabet","type":"Regexp"}},"points":1,"order":false,"question_comment":""},"question-2":{"question_text":"The three stooges are ---, ---, and ---.","answers":{"qfi3-1":{"answer_text":"larry","correct":true,"explanation":null,"type":"String"},"qfi3-2":{"answer_text":"moe","correct":true,"explanation":null,"type":"String"},"qfi3-3":{"answer_text":"curly","correct":true,"explanation":null,"type":"String"}},"points":1,"order":true,"question_comment":""},"question-3":{"question_text":"\n      Calculate the determinant of this matrix:\n      $$\\mathbf{A} = \\begin{vmatrix} \n      1 & 3 \\\\ \n      2 & 4 \n      \\end{vmatrix}$$\n      <br/>\n      ---\n    ","answers":{"qfi4-1":{"answer_text":-1,"correct":true,"explanation":null,"type":"Fixnum"}},"points":1,"order":false,"question_comment":""},"question-4":{"question_text":"\n      Solve: \n      $$\\binom{n}{k} = \\frac{n!}{k!(n-k)!}$$\n      when n = 5 and k = 2:\n      ---\n    ","answers":{"qfi5-1":{"answer_text":10,"correct":true,"explanation":null,"type":"Fixnum"},"qfi5-2":{"answer_text":9,"correct":false,"explanation":"Not exactly","type":"Fixnum"}},"points":1,"order":false,"question_comment":""},"question-5":{"question_text":"\n      When x = 2, the solution of $\\sqrt{3x+3}+(1+x)^2$ is:\n      ---\n    ","answers":{"qfi6-1":{"answer_text":12,"correct":true,"explanation":null,"type":"Fixnum"},"qfi6-2":{"answer_text":11,"correct":false,"explanation":"Try again!","type":"Fixnum"}},"points":1,"order":false,"question_comment":""},"question-6":{"question_text":"What is the largest US state?","answers":{"qmc7-1":{"answer_text":"Texas","correct":false,"explanation":"That's pretty big, but think colder."},"qmc7-2":{"answer_text":"Hawaii","correct":false,"explanation":"Not big enough."},"qmc7-3":{"answer_text":"Alaska","correct":true,"explanation":null}},"points":1,"question_comment":""},"question-7":{"question_text":"Which are American political parties?","answers":{"qsm8-1":{"answer_text":"Democrats","correct":true,"explanation":null},"qsm8-2":{"answer_text":"Republicans","correct":true,"explanation":null},"qsm8-3":{"answer_text":"Greens","correct":true,"explanation":"Yes, they're a party!"},"qsm8-4":{"answer_text":"Tories","correct":false,"explanation":"They're British"},"qsm8-5":{"answer_text":"Social Democrats","correct":false,"explanation":""}},"points":1,"question_comment":""},"question-8":{"question_text":"True or False: The earth is flat.","answers":{"qmc9-1":{"answer_text":"True","correct":false,"explanation":"No, just looks that way"},"qmc9-2":{"answer_text":"False","correct":true,"explanation":null}},"points":1,"question_comment":""},"question-9":{"question_text":"What does the following code do:\n    <pre>\n    puts \"Hello world!\"\n    </pre>\n    ","answers":{"qmc10-1":{"answer_text":"Throws an exception","correct":false,"explanation":"Don't be an idiot."},"qmc10-2":{"answer_text":"Prints a friendly message","correct":true,"explanation":null}},"points":1,"question_comment":""}};

      function findCorrectAnswer(idQuestion, questionType) {
        correctIds = [];
        for (id in data[idQuestion]['answers']) {
          if(data[idQuestion]['answers'][id.toString()]['correct'] == true)
            if (questionType == 0)
              return id.toString();
            else {
              correctIds.push(id.toString());
            } 
        }
        return correctIds;
      }
      
      function checkSelectMultiple(x, checkedIds, correctIds) {
        results = [];
        
        $.each(checkedIds, function(index, value){
          if (correctIds.indexOf(value) == -1) {
            results.push(false);
            printResults(value, 0, data[x.toString()]['answers'][value]['explanation'], 0);
          }
          else {
            results.push(true);
            printResults(value, 1, data[x.toString()]['answers'][value]['explanation'], 0);
          }
        });
        
        nCorrects = 0;
        nIncorrects = 0;
        $.each(results, function(index, value){
          if (value == true)
            nCorrects += 1;
          else
            nIncorrects += 1;
        });
        
        calculateMark(data[x.toString()], x.toString(), null, 3, nCorrects, nIncorrects);
      }
      
      function printResults(id, type, explanation, typeQuestion) {
        if (typeQuestion == 0) {                                        // MultipleChoice and SelectMultiple
          $("br[class=" + id + "br" + "]").detach();
          if (type == 1) {
            if ((explanation == "") || (explanation == null))
              $("div[id ~= " + id + "r" + "]").html("<strong class=correct> Correct</strong></br>");
            else
              $("div[id ~= " + id + "r" + "]").html("<strong class=correct> Correct - " + explanation + "</strong></br>");
          }
          else {
            if ((explanation == "") || (explanation == null))
              $("div[id ~= " + id + "r" + "]").html("<strong class=incorrect> Incorrect</strong></br>");
            else
              $("div[id ~= " + id + "r" + "]").html("<strong class=incorrect> Incorrect - " + explanation + "</strong></br>");
          }
        }
        else {          // FillIn
          for (r in id) {
            input = $("#" + r.toString());
            if (id[r] == true)
              input.attr('class', 'fillin correct');
            else { 
              if ((id[r] == false) || (id[r] != "n/a"))
                input.attr('class', 'fillin incorrect');
            }
            
            if ((id[r] != true) && (id[r] != false) && (id[r] != "n/a")) {
              if (explanation[id[r].toString()] != null)
                $("div[id ~= " + r.toString() + "r" + "]").html(" <div class=explanation>" + explanation[id[r].toString()] + "</div>");
            }
            else {
              if (explanation[r] != null)
                $("div[id ~= " + r + "r" + "]").html(" <div class=explanation>" + explanation[r] + "</div>");
            }
          }
        }
      }
      
      function calculateMark(question, id, result, typeQuestion, numberCorrects, numberIncorrects) {
        if (typeQuestion == 2) {
          if (result)
            $("#" + id).append("<strong class=mark> " + question['points'].toFixed(2) + "/" + question['points'].toFixed(2) + " points</strong></br></br>");
          else
            $("#" + id).append("<strong class=mark> 0.00/" + question['points'].toFixed(2) + " points</strong></br></br>");
        }
        else if (typeQuestion == 1) {
          size = 0;
          for (y in question['answers'])
            if (question['answers'][y]['correct'] == true)
              size += 1;
          
          $("#" + id).append("<strong class=mark> " + ((question['points'] / size) * numberCorrects).toFixed(2) + "/" + question['points'].toFixed(2) + " points</strong></br></br>");
        }
        else {
          totalCorrects = 0;
          for (y in question['answers']) {
            if (question['answers'][y]['correct'] == true)
              totalCorrects += 1;
          }
          
          correctAnswerPoints = question['points'] / totalCorrects;
          penalty = correctAnswerPoints * numberIncorrects;
          mark = (correctAnswerPoints * numberCorrects) - penalty;
          
          if (mark < 0)
            mark = 0;
            
          $("#" + id).append("<strong class=mark> " + mark.toFixed(2) + "/" + question['points'].toFixed(2) + " points</strong></br></br>");        
        }
      }
      
      function checkFillin(correctAnswers, userAnswers, distractorAnswers, typeCorrection) {
        correction = {};
        checkedAnswers = {};
        
        if (typeCorrection == 0) {          // Order doesn't matter
          for (u in userAnswers) {
            if (userAnswers[u] != undefined) {    // No empty field
              matchedCorrect = false;
              for (y in correctAnswers) {
                if (checkAnswers[u] == undefined) {
                  if ((typeof(correctAnswers[y]) == "string") || (typeof(correctAnswers[y]) == "number")) {    // Answer is a String or a Number
                    if (userAnswers[u] == correctAnswers[y]) {
                      correction[u] = true;
                      checkedAnswers[u] = userAnswers[u];
                      matchedCorrect = true;
                      break;
                    }
                  }
                  else {  // Answer is a Regexp
                    if (userAnswers[u].match(correctAnswers[y])) {
                      correction[u] = true;
                      checkedAnswers[u] = userAnswers[u];
                      matchedCorrect = true;
                      break;
                    }
                  }
                }
              }
              if (!matchedCorrect)
                correction[u] = false;
            }
            else
              correction[u] = "n/a";
          }
        }
        else {                            // Order matters
          for (u in userAnswers) {
            if (userAnswers[u] != undefined) {
              if ((typeof(correctAnswers[u]) == "string") || (typeof(correctAnswers[u]) == "number")) {
                if (userAnswers[u] == correctAnswers[u])
                  correction[u] = true;
                else
                  correction[u] = false;
              }
              else {
                if (userAnswers[u].match(correctAnswers[u]))
                  correction[u] = true;
                else
                  correction[u] = false;
              }
            }
            else
              correction[u] = "n/a";
          }
        }
        
        if (Object.keys(userAnswers).length == 1) {
          for (u in userAnswers) {
            if (correction[u] == false) {
              for (y in distractorAnswers) {
                if ((typeof(distractorAnswers[y]) == "string") || (typeof(distractorAnswers[y]) == "number")) {
                  if (userAnswers[u] == distractorAnswers[y])
                    correction[u] = y.toString();
                }
                else {
                  if (userAnswers[u].match(distractorAnswers[y]))
                    correction[u] = y.toString();
                }
              }
            }
          }
        }
        return correction;
      }
      
      function checkAnswers() {
        
        for (x in data) {
          if ($("#" + x.toString() + " strong").length == 0) {
            correct = false;
            answers = $("#" + x.toString() + " input");
            
            if (answers.attr('class') == "fillin") {
              correctAnswers = {};
              distractorAnswers = {};
              explanation = {};
              stringAnswer = false;
              
              for (ans in data[x.toString()]['answers']) {
                if (data[x.toString()]['answers'][ans]['correct'] == true) {
                  if (data[x.toString()]['answers'][ans]['type'] == "Regexp") {
                    string = data[x.toString()]['answers'][ans]['answer_text'].split('/');
                    regexp = string[1];
                    options = string[2];
                    correctAnswers[ans.toString()] = RegExp(regexp, options);
                  }
                  else { // String or Number
                    correctAnswers[ans.toString()] = data[x.toString()]['answers'][ans]['answer_text'];
                    stringAnswer = true;
                  }
                }
                else {
                  if (data[x.toString()]['answers'][ans]['type'] == "Regexp") {
                    string = data[x.toString()]['answers'][ans]['answer_text'].split('/');
                    regexp = string[1];
                    options = string[2];
                    distractorAnswers[ans.toString()] = RegExp(regexp, options);
                  }
                  else {// String or Number
                    distractorAnswers[ans.toString()] = data[x.toString()]['answers'][ans]['answer_text'];
                    stringAnswer = true;
                  }
                }
                explanation[ans] = data[x.toString()]['answers'][ans]['explanation'];
              }
              
              userAnswers = {};
              for (i = 0; i < answers.length; i++) {
                if (answers[i].value == '')
                  userAnswers[answers[i].id.toString()] = undefined;
                else
                  if (stringAnswer)
                    userAnswers[answers[i].id.toString()] = answers[i].value.toLowerCase();
                  else
                    userAnswers[answers[i].id.toString()] = answers[i].value;
              }
              
              if (data[x.toString()]['order'] == false)
                results = checkFillin(correctAnswers, userAnswers, distractorAnswers, 0);
              else
                results = checkFillin(correctAnswers, userAnswers, distractorAnswers, 1);
                
              allEmpty = true;
              nCorrects = 0;
              
              for (r in results) {
                if (results[r] == true)
                  nCorrects += 1;
                if (results[r] != "n/a")
                  allEmpty = false;
              }
              
              if (!allEmpty) {
                printResults(results, null, explanation, 1);
                calculateMark(data[x.toString()], x.toString(), null, 1, nCorrects, null);
              }
            }
            
            else if (answers.attr('class') == "select") {
              idCorrectAnswer = findCorrectAnswer(x.toString(), 0);
              
              if ($("#" + x.toString() + " :checked").size() != 0) {
                if ($("#" + x.toString() + " :checked").attr('id') == idCorrectAnswer) {
                  printResults($("#" + x.toString() + " :checked").attr('id'), 1, "", 0);
                  correct = true;
                }
                else {
                  id = $("#" + x.toString() + " :checked").attr('id');
                  printResults(id, 0, data[x.toString()]['answers'][id]['explanation'], 0);
                }
                calculateMark(data[x.toString()], x.toString(), correct, 2, null, null);
              }
            }
            
            else {
              if ($("#" + x.toString() + " :checked").size() != 0) {
                answers = $("#" + x.toString() + " :checked");
                checkedIds = [];
                
                $.each(answers, function(index, value){
                  checkedIds.push(value['id']);
                });
                
                correctIds = [];
                correctIds = findCorrectAnswer(x.toString(), 1);
                checkSelectMultiple(x, checkedIds, correctIds);
              }
            }
          }
        }
      }

      $("#submit").click(function() {
        checkAnswers();
        filledAllQuiz = true;
        
        for (x in data) {
          if ($("#" + x.toString() + " strong").length == 0)
            filledAllQuiz = false; 
        }
        if (filledAllQuiz)
          $("#submit").detach();
      });

      $("#reset").click(function() {
        window.location.reload();
      });
    </script>
  </body>
</html>
